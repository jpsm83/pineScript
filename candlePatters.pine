// Most commun candle patterns

//@version=5
indicator("Candle patterns", overlay = true)

// bullish candlesticks pattern
// morning start - the first candle should be short and bearish, the second one should be at the button and signal indecision (green or red),
// while the third and final candle signals a reversal is starting, as the sellers are no longer in control over the price action.
morningStart = (close[barstate.isconfirmed ? 2 : 3] < open[barstate.isconfirmed ? 2 : 3] and math.max(open[barstate.isconfirmed ? 1 : 2], close[barstate.isconfirmed ? 1 : 2]) < close[barstate.isconfirmed ? 2 : 3] and open[barstate.isconfirmed ? 0 : 1] > math.max(open[barstate.isconfirmed ? 1 : 2], close[barstate.isconfirmed ? 1 : 2]) and close[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 0 : 1])
// hammer - candle has a small body (green or red), with a long down wick, happens in a short trend, it is a bullish reversal pattern which signals potential change in the price direction
hammer = (((high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 3* (open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1])) and ((close[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) / (.001 + high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 0.6) and ((open[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) / (.001 + high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 0.6))
// bullish engulfing - a short candlestick follow[barstate.isconfirmed ? 0 : 1]ed by a large up candlestick that eclipses or "engulfs" the smaller down candle. signal trend reverse to upside
bullishEngulfing = (open[barstate.isconfirmed ? 1 : 2] > close[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 0 : 1] and close[barstate.isconfirmed ? 0 : 1] >= open[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 1 : 2] >= open[barstate.isconfirmed ? 0 : 1] and close[barstate.isconfirmed ? 0 : 1] - open[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 1 : 2] - close[barstate.isconfirmed ? 1 : 2])
// bullish harami - two bar candlestick pattern that suggests prices may soon reverse to the upside. The pattern consists of a short
// candle follow[barstate.isconfirmed ? 0 : 1]ed by a small candle. The opening and closing prices of the second candle must be contained within the body of the first candle.
bullishHarami = (open[barstate.isconfirmed ? 1 : 2] > close[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 0 : 1] and close[barstate.isconfirmed ? 0 : 1] <= open[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 1 : 2] <= open[barstate.isconfirmed ? 0 : 1] and close[barstate.isconfirmed ? 0 : 1] - open[barstate.isconfirmed ? 0 : 1] < open[barstate.isconfirmed ? 1 : 2] - close[barstate.isconfirmed ? 1 : 2])
// piercing line - two-day, candlestick price pattern that marks a potential short-term reversal from a downward trend to an upward trend.
// The pattern includes the first day opening near the high[barstate.isconfirmed ? 0 : 1] and closing near the low[barstate.isconfirmed ? 0 : 1] with an average or larger-sized trading range.
piercingLine = (close[barstate.isconfirmed ? 1 : 2] < open[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] < low[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 1 : 2] + ((open[barstate.isconfirmed ? 1 : 2] - close[barstate.isconfirmed ? 1 : 2]) / 2) and close[barstate.isconfirmed ? 0 : 1] < open[barstate.isconfirmed ? 1 : 2])
// bullish belt - single-day Japanese candlestick pattern that suggests a possible reversal of the prevailing downtrend.
// The pattern forms when, follow[barstate.isconfirmed ? 0 : 1]ing a stretch of bearish trades, a bullish or white candlestick occurs
bullishBelt = (low[barstate.isconfirmed ? 0 : 1] == open[barstate.isconfirmed ? 0 : 1] and open[barstate.isconfirmed ? 0 : 1] < ta.lowest(10)[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] < close[barstate.isconfirmed ? 0 : 1] and close[barstate.isconfirmed ? 0 : 1] > ((high[barstate.isconfirmed ? 1 : 2] - low[barstate.isconfirmed ? 1 : 2]) / 2) + low[barstate.isconfirmed ? 1 : 2])
// bullish kicker - consists of two candles, and that's believed to signal a coming swing to the upside. Can be formed in an
// uptrend or downtrend, and is made up of a bullish candle that's preceded by a gap to the upside and bearish candle.
bullishKicker = (open[barstate.isconfirmed ? 1 : 2] > close[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] >= open[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 0 : 1])
// inverted hammer - candle has a small body (green or red), with a long up wick, happens in a short trend, it is a bullish reversal pattern which signals potential change in the price direction
invertedHammer = (((high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 3* (open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1])) and ((high[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1]) / (.001 + high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 0.6) and ((high[barstate.isconfirmed ? 0 : 1] - open[barstate.isconfirmed ? 0 : 1]) / (.001 + high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) > 0.6))
bullishInsideBar = open[barstate.isconfirmed ? 1 : 2] > close[barstate.isconfirmed ? 1 : 2] and (0.30 * math.abs(open[barstate.isconfirmed ? 1 : 2] - close[barstate.isconfirmed ? 1 : 2])) > open[barstate.isconfirmed ? 1 : 2] - close[barstate.isconfirmed ? 0 : 1]
bullishCandle = morningStart or hammer or bullishEngulfing or bullishHarami or piercingLine or bullishBelt or bullishKicker or invertedHammer or bullishInsideBar

// bearish candlesticks pattern
// bearish harami - two bar candlestick pattern that suggests prices may soon reverse to the downside. The pattern consists of a long
// candle follow[barstate.isconfirmed ? 0 : 1]ed by a small candle. The opening and closing prices of the second candle must be contained within the body of the first candle.
bearishHarami = (close[barstate.isconfirmed ? 1 : 2] > open[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 0 : 1] and open[barstate.isconfirmed ? 0 : 1] <= close[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 1 : 2] <= close[barstate.isconfirmed ? 0 : 1] and open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1] < close[barstate.isconfirmed ? 1 : 2] - open[barstate.isconfirmed ? 1 : 2])
// evening start - the first candle should be long and bullish, the second one should be at the top and signal indecision (green or red),
// while the third and final candle signals a reversal is starting, as the buyers are no longer in control over the price action.
eveningStar = (close[barstate.isconfirmed ? 2 : 3] > open[barstate.isconfirmed ? 2 : 3] and math.min(open[barstate.isconfirmed ? 1 : 2], close[barstate.isconfirmed ? 1 : 2]) > close[barstate.isconfirmed ? 2 : 3] and open[barstate.isconfirmed ? 0 : 1] < math.min(open[barstate.isconfirmed ? 1 : 2], close[barstate.isconfirmed ? 1 : 2]) and close[barstate.isconfirmed ? 0 : 1] < open[barstate.isconfirmed ? 0 : 1])
// bearish engulfing - a long candlestick follow[barstate.isconfirmed ? 0 : 1]ed by a large down candlestick that eclipses or "engulfs" the smaller up candle. signal trend reverse to downside
bearishEngulfing = (close[barstate.isconfirmed ? 1 : 2] > open[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 0 : 1] and open[barstate.isconfirmed ? 0 : 1] >= close[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 1 : 2] >= close[barstate.isconfirmed ? 0 : 1] and open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 1 : 2] - open[barstate.isconfirmed ? 1 : 2])
// shooting start - candle has a small body (green or red), with a long up wick, happens in a long trend, it is a bearish reversal pattern which signals potential change in the price direction
shootingStar = (open[barstate.isconfirmed ? 1 : 2] < close[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 1 : 2] and high[barstate.isconfirmed ? 0 : 1] - math.max(open[barstate.isconfirmed ? 0 : 1], close[barstate.isconfirmed ? 0 : 1]) >= math.abs(open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1]) * 3 and math.min(close[barstate.isconfirmed ? 0 : 1], open[barstate.isconfirmed ? 0 : 1]) - low[barstate.isconfirmed ? 0 : 1] <= math.abs(open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1]))
// bearish kicker - consists of two candles, and that's believed to signal a coming swing to the downside. Can be formed in an
// uptrend or downtrend, and is made up of a bearish candle that's preceded by a gap to the downside and bullish candle.
bearishKicker = (open[barstate.isconfirmed ? 1 : 2] < close[barstate.isconfirmed ? 1 : 2] and open[barstate.isconfirmed ? 0 : 1] <= open[barstate.isconfirmed ? 1 : 2] and close[barstate.isconfirmed ? 0 : 1] <= open[barstate.isconfirmed ? 0 : 1])
// hanging man - occurs during an uptrend and warns that prices may start falling. The candle is composed of a small real body,
// a long low[barstate.isconfirmed ? 0 : 1]er shadow, and little or no upper shadow. The hanging man shows that selling interest is starting to increase.
hangingMan = (((high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1] > 4* (open[barstate.isconfirmed ? 0 : 1] - close[barstate.isconfirmed ? 0 : 1])) and ((close[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) / (.001+high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) >= 0.75) and ((open[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) / (.001+high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1]) >= 0.75)) and high[barstate.isconfirmed ? 1 : 2] < open[barstate.isconfirmed ? 0 : 1] and high[barstate.isconfirmed ? 2 : 3] < open[barstate.isconfirmed ? 0 : 1])
// dark cloud cover - bearish reversal candlestick pattern where a down candle opens above the close of the prior up candle, and then closes below[barstate.isconfirmed ? 0 : 1] the midpoint of the up candle.
darkCloudCover = ((close[barstate.isconfirmed ? 1 : 2] > open[barstate.isconfirmed ? 1 : 2]) and (((close[barstate.isconfirmed ? 1 : 2] + open[barstate.isconfirmed ? 1 : 2]) / 2) > close[barstate.isconfirmed ? 0 : 1]) and (open[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 0 : 1]) and (open[barstate.isconfirmed ? 0 : 1] > close[barstate.isconfirmed ? 1 : 2]) and (close[barstate.isconfirmed ? 0 : 1] > open[barstate.isconfirmed ? 1 : 2]) and ((open[barstate.isconfirmed ? 0 : 1]- close[barstate.isconfirmed ? 0 : 1]) / (.001+(high[barstate.isconfirmed ? 0 : 1] - low[barstate.isconfirmed ? 0 : 1])) > 0.6))
bearishInsideBar = open[barstate.isconfirmed ? 1 : 2] < close[barstate.isconfirmed ? 1 : 2] and (0.30 * math.abs(close[barstate.isconfirmed ? 1 : 2] - open[barstate.isconfirmed ? 1 : 2])) > close[barstate.isconfirmed ? 0 : 1] - open[barstate.isconfirmed ? 1 : 2]
bearishCandle = bearishHarami or eveningStar or bearishEngulfing or shootingStar or bearishKicker or hangingMan or darkCloudCover or bearishInsideBar

plotshape(morningStart, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="morningStart", size = size.huge)
plotshape(hammer, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="hammer", size = size.huge)
plotshape(bullishEngulfing, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="bullish\nEngulfing", size = size.huge)
plotshape(bullishHarami, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="bullish\nHarami", size = size.huge)
plotshape(piercingLine, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="piercing\nLine", size = size.huge)
plotshape(bullishBelt, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="bullish\nBelt", size = size.huge)
plotshape(bullishKicker, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="bullish\nKicker", size = size.huge)
plotshape(invertedHammer, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="inverted\nHammer", size = size.huge)
plotshape(bullishInsideBar, style=shape.arrowup, location=location.belowbar, color=color.green, textcolor=color.white, text="bullish\nInside\nBar", size = size.huge)

plotshape(bearishHarami, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="bearish\nHarami", size = size.huge)
plotshape(eveningStar, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="evening\nStar", size = size.huge)
plotshape(bearishEngulfing, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="bearish\nEngulfing", size = size.huge)
plotshape(shootingStar, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="shooting\nStar", size = size.huge)
plotshape(bearishKicker, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="bearish\nKicker", size = size.huge)
plotshape(hangingMan, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="hangingMan", size = size.huge)
plotshape(darkCloudCover, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="dark\nCloud\nCover", size = size.huge)
plotshape(bearishInsideBar, style=shape.arrowdown, location=location.abovebar, color=color.red, textcolor=color.white, text="bearish\nInside\nBar", size = size.huge)
